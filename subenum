#!/bin/bash

if [ $# -ne 1 ]; then
    echo "Usage: $0 <targets_list>"
    exit 1
fi

targets_list="$1"

# Download the latest resolvers.txt file
rm -f ~/wordlist/resolvers.txt
curl -sS -L https://raw.githubusercontent.com/trickest/resolvers/main/resolvers.txt -o ~/wordlist/resolvers.txt

# Perform subdomain enumeration using various tools
cat "$targets_list" | while read target; do
    sublist3r -d "$target" | anew sublist3r_"$target".txt
    findomain -t "$target" -u findomain_"$target".txt
    subfinder -all -d "$target" -o subfinder_"$target".txt
    shodanx subdomain -d "$target" -to 50 -ra -o shodan_"$target".txt
    shuffledns -mode bruteforce -w ~/wordlist/dns/best-dns-wordlist.txt -r ~/wordlist/resolvers.txt -d "$target" -o shuffledns_bruteforce_"$target".txt
done

# Concatenate all subdomain enumeration results and process with shuffledns
cat sublist3r_*.txt findomain_*.txt subfinder_*.txt shodan_*.txt shuffledns_bruteforce_*.txt | sed 's/\*\.\?//g' | sort -u | shuffledns -mode resolve -r ~/wordlist/resolvers.txt -o resolved_subdomains.txt

# Clean up temporary files
rm sublist3r_*.txt findomain_*.txt subfinder_*.txt shodan_*.txt shuffledns_bruteforce_*.txt

# Notify completion
echo "Subdomain enumeration done" | notify
